<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kanji Fall Quiz</title>
  <style>
    body {
      font-family: sans-serif;
      background-color: #f0f0f0;
      margin: 0;
      padding: 0;
      text-align: center;
      transition: background-color 0.3s ease;
    }

    #game-container {
      width: 100%;
      height: 100vh;
      position: relative;
      overflow: hidden;
      background-color: #e0f7fa;
    }

    #falling-kanji {
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      font-size: 4rem;
      animation: fall 3s linear forwards;
    }

    @keyframes fall {
      from {
        top: 130px;
      }
      to {
        top: 65%;
      }
    }

    #buttons {
      position: absolute;
      bottom: 15%;
      width: 100%;
      display: flex;
      justify-content: center;
      gap: 30px;
    }

    #buttons button {
      padding: 15px 30px;
      font-size: 1.2rem;
      border-radius: 10px;
      border: none;
      background-color: #80deea;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    #buttons button:hover {
      background-color: #4dd0e1;
    }

    #scoreboard {
      position: absolute;
      bottom: 5%;
      width: 100%;
      font-size: 1.2rem;
    }

    #kanji {
      opacity: 0;
      transition: opacity 0.5s ease-in;
    }

    #kanji.visible {
      opacity: 1;
    }

    #progress-container {
      position: absolute;
      top: 5%;
      left: 50%;
      transform: translateX(-50%);
      width: 80%;
      height: 20px;
      background-color: #b2ebf2;
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 10px;
    }

    #progress-fill {
      height: 100%;
      width: 0%;
      background-color: #26c6da;
      border-radius: 10px 0 0 10px;
      transition: width 0.3s ease;
    }

    #progress-text {
      margin-bottom: 10px;
      font-size: 1rem;
      color: #007c91;
    }

    /* Game Over Screen */

    #game-over {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      border-radius: 20px;
      box-shadow: 0 0 20px rgba(0,0,0,0.2);
      padding: 40px;
      text-align: center;
      z-index: 10;
      display: none;
      width: 300px;
    }

    #game-over h2 {
      font-size: 2rem;
      margin-bottom: 10px;
    }

    #game-over p {
      font-size: 1.2rem;
      margin-bottom: 20px;
    }

    #restart-btn {
      padding: 12px 24px;
      font-size: 1.1rem;
      border: none;
      background-color: #4dd0e1;
      border-radius: 10px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    #restart-btn:hover {
      background-color: #26c6da;
    }
  </style>
</head>
<body>
  <div id="game-container">
    <div id="progress-text">Question 0 of 5</div>
    <div id="progress-container">
      <div id="progress-fill"></div>
    </div>

    <div id="falling-kanji">
      <span id="kanji">本</span>
    </div>

    <div id="buttons">
      <button id="option1">Option 1</button>
      <button id="option2">Option 2</button>
    </div>

    <div id="scoreboard">Score: <span id="score">0</span></div>
  </div>

  <div id="game-over">
    <h2>Game Over</h2>
    <p id="final-score">Your score: 0</p>
    <button id="restart-btn">Play Again</button>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const kanjiData = [
        { kanji: "本", correct: "book", incorrect: "river" },
        { kanji: "川", correct: "river", incorrect: "mountain" },
        { kanji: "森", correct: "forest", incorrect: "book" },
        { kanji: "山", correct: "mountain", incorrect: "forest" },
        { kanji: "水", correct: "water", incorrect: "fire" },
        { kanji: "火", correct: "fire", incorrect: "tree" },
        { kanji: "木", correct: "tree", incorrect: "stone" },
        { kanji: "石", correct: "stone", incorrect: "sky" },
        { kanji: "空", correct: "sky", incorrect: "ground" },
        { kanji: "土", correct: "earth", incorrect: "wind" },
        { kanji: "風", correct: "wind", incorrect: "rain" },
        { kanji: "雨", correct: "rain", incorrect: "sun" },
        { kanji: "日", correct: "sun", incorrect: "moon" },
        { kanji: "月", correct: "moon", incorrect: "sun" },
        { kanji: "人", correct: "person", incorrect: "animal" },
        { kanji: "犬", correct: "dog", incorrect: "cat" },
        { kanji: "猫", correct: "cat", incorrect: "dog" },
        { kanji: "魚", correct: "fish", incorrect: "bird" },
        { kanji: "鳥", correct: "bird", incorrect: "fish" },
        { kanji: "車", correct: "car", incorrect: "train" },
      ];

      const MAX_QUESTIONS = 5;
      let questionCount = 0;
      let score = 0;
      let questionInProgress = false;

      const scoreEl = document.getElementById("score");
      const kanjiEl = document.getElementById("kanji");
      const option1 = document.getElementById("option1");
      const option2 = document.getElementById("option2");
      const fallingKanji = document.getElementById("falling-kanji");
      const progressText = document.getElementById("progress-text");
      const progressFill = document.getElementById("progress-fill");
      const gameOverScreen = document.getElementById("game-over");
      const finalScoreEl = document.getElementById("final-score");
      const restartBtn = document.getElementById("restart-btn");

      // Optional sounds (uncomment and add your wav files in a 'sounds' folder)
      // const correctSound = new Audio("sounds/correct.wav");
      // const wrongSound = new Audio("sounds/wrong.wav");
      // const fallSound = new Audio("sounds/fall.wav");
      // correctSound.load();
      // wrongSound.load();
      // fallSound.load();

      const loadNewQuestion = () => {
        if (questionCount >= MAX_QUESTIONS) {
          showGameOver();
          return;
        }

        questionInProgress = true;
        questionCount++;

        progressText.textContent = `Question ${questionCount} of ${MAX_QUESTIONS}`;
        progressFill.style.width = `${(questionCount / MAX_QUESTIONS) * 100}%`;

        const q = kanjiData[Math.floor(Math.random() * kanjiData.length)];
        const isCorrectLeft = Math.random() < 0.5;

        kanjiEl.classList.remove("visible");
        kanjiEl.textContent = q.kanji;

        fallingKanji.style.animation = "none";
        void fallingKanji.offsetWidth;

        setTimeout(() => {
          kanjiEl.classList.add("visible");
          fallingKanji.style.animation = "fall 5s linear forwards";
          // fallSound.play();
        }, 50);

        if (isCorrectLeft) {
          option1.textContent = q.correct;
          option2.textContent = q.incorrect;
          option1.onclick = () => answer(true);
          option2.onclick = () => answer(false);
        } else {
          option1.textContent = q.incorrect;
          option2.textContent = q.correct;
          option1.onclick = () => answer(false);
          option2.onclick = () => answer(true);
        }

        option1.disabled = false;
        option2.disabled = false;
      };

      const answer = (isCorrect) => {
        if (!questionInProgress) return;
        questionInProgress = false;

        option1.disabled = true;
        option2.disabled = true;

        if (isCorrect) {
          // correctSound.play();
          score++;
          document.body.style.backgroundColor = "#d0f8ce";
        } else {
          // wrongSound.play();
          score--;
          document.body.style.backgroundColor = "#ffcdd2";
        }

        scoreEl.textContent = score;

        setTimeout(() => {
          document.body.style.backgroundColor = "#f0f0f0";
          kanjiEl.classList.remove("visible");
          setTimeout(() => loadNewQuestion(), 300);
        }, 300);
      };

      fallingKanji.addEventListener("animationend", () => {
        if (!questionInProgress) return;
        questionInProgress = false;

        score--;
        scoreEl.textContent = score;

        option1.disabled = true;
        option2.disabled = true;

        kanjiEl.classList.remove("visible");

        setTimeout(() => loadNewQuestion(), 500);
      });

      const showGameOver = () => {
        gameOverScreen.style.display = "block";
        finalScoreEl.textContent = `Your score: ${score} / ${MAX_QUESTIONS}`;

        fallingKanji.style.display = "none";
        option1.style.display = "none";
        option2.style.display = "none";
        document.getElementById("progress-container").style.display = "none";
        progressText.style.display = "none";
      };

      restartBtn.onclick = () => {
        console.log("Restart button clicked");

        score = 0;
        questionCount = 0;
        questionInProgress = false;
        scoreEl.textContent = score;
        progressText.textContent = `Question 0 of ${MAX_QUESTIONS}`;
        progressFill.style.width = "0%";

        gameOverScreen.style.display = "none";
        fallingKanji.style.display = "block";
        option1.style.display = "inline-block";
        option2.style.display = "inline-block";
        document.getElementById("progress-container").style.display = "block";
        progressText.style.display = "block";

        loadNewQuestion();
      };

      loadNewQuestion();
    });
  </script>
</body>
</html>
